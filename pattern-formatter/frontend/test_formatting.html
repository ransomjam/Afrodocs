<!DOCTYPE html>
<html>
<head>
    <title>Formatting Options Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        h2 {
            color: #555;
            margin-top: 20px;
        }
        .form-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }
        input, select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            width: 100%;
            max-width: 300px;
        }
        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px 5px 5px 0;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            background: #f9f9f9;
            padding: 10px;
            border-left: 4px solid #007bff;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
        .success {
            color: #28a745;
        }
        .error {
            color: #dc3545;
        }
        textarea {
            width: 100%;
            height: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="test-section">
        <h1>ðŸ“„ Document Formatting Options Test</h1>
        <p>Test the formatting options implementation for upload and paste functionality.</p>
    </div>

    <div class="test-section">
        <h2>Test 1: Upload with Custom Formatting</h2>
        <div class="form-group">
            <label>Font Size (pt):</label>
            <select id="fontSize1">
                <option value="10">10 pt (Small)</option>
                <option value="11">11 pt</option>
                <option value="12" selected>12 pt (Standard)</option>
                <option value="13">13 pt</option>
                <option value="14">14 pt (Large)</option>
            </select>
        </div>
        <div class="form-group">
            <label>Line Spacing:</label>
            <select id="lineSpacing1">
                <option value="1.0">Single (1.0)</option>
                <option value="1.15">1.15</option>
                <option value="1.5" selected>1.5 (Standard)</option>
                <option value="2.0">Double (2.0)</option>
            </select>
        </div>
        <div class="form-group">
            <label>Margins (cm):</label>
            <input type="number" id="margin1" value="2.5" min="0.5" max="5" step="0.5">
        </div>
        <div class="form-group">
            <label>
                <input type="checkbox" id="toc1"> Include Table of Contents
            </label>
        </div>
        <div class="form-group">
            <label>Select File:</label>
            <input type="file" id="file1" accept=".txt,.docx,.md">
        </div>
        <button onclick="testUpload()">Test Upload with Formatting</button>
        <div id="result1" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Paste with Custom Formatting</h2>
        <div class="form-group">
            <label>Font Size (pt):</label>
            <select id="fontSize2">
                <option value="10">10 pt (Small)</option>
                <option value="11">11 pt</option>
                <option value="12" selected>12 pt (Standard)</option>
                <option value="13">13 pt</option>
                <option value="14">14 pt (Large)</option>
            </select>
        </div>
        <div class="form-group">
            <label>Line Spacing:</label>
            <select id="lineSpacing2">
                <option value="1.0">Single (1.0)</option>
                <option value="1.15">1.15</option>
                <option value="1.5" selected>1.5 (Standard)</option>
                <option value="2.0">Double (2.0)</option>
            </select>
        </div>
        <div class="form-group">
            <label>Margins (cm):</label>
            <input type="number" id="margin2" value="2.5" min="0.5" max="5" step="0.5">
        </div>
        <div class="form-group">
            <label>
                <input type="checkbox" id="toc2"> Include Table of Contents
            </label>
        </div>
        <div class="form-group">
            <label>Paste Text Content:</label>
            <textarea id="text2" placeholder="Paste your document text here...">Introduction

This is a test document for the formatting options feature.

Main Section

This section contains some content to test font size, line spacing, and margins.

Subsection

More content here.

Conclusion

End of test document.</textarea>
        </div>
        <button onclick="testPaste()">Test Paste with Formatting</button>
        <div id="result2" class="result" style="display:none;"></div>
    </div>

    <div class="test-section">
        <h2>Test Results Summary</h2>
        <div id="summary" style="display:none;"></div>
        <p>Check the browser console (F12) for detailed logs.</p>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000';

        async function testUpload() {
            const fileInput = document.getElementById('file1');
            const file = fileInput.files[0];
            
            if (!file) {
                showResult('result1', 'Please select a file first.', 'error');
                return;
            }

            const fontSize = document.getElementById('fontSize1').value;
            const lineSpacing = document.getElementById('lineSpacing1').value;
            const margin = document.getElementById('margin1').value;
            const toc = document.getElementById('toc1').checked;

            showResult('result1', 'Uploading file with formatting options...', 'info');
            console.log('Test Upload:', { fileName: file.name, fontSize, lineSpacing, margin, toc });

            try {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('font_size', fontSize);
                formData.append('line_spacing', lineSpacing);
                formData.append('margin_cm', margin);
                formData.append('include_toc', String(toc));

                console.log('FormData entries:');
                for (let [key, value] of formData.entries()) {
                    console.log(`  ${key}: ${value}`);
                }

                const response = await fetch(`${API_BASE}/upload`, {
                    method: 'POST',
                    body: formData,
                    credentials: 'include'
                });

                if (!response.ok) {
                    const error = await response.json();
                    showResult('result1', `Error: ${error.error || response.statusText}`, 'error');
                    console.error('Upload error:', error);
                    return;
                }

                const data = await response.json();
                showResult('result1', `âœ“ Success! Job ID: ${data.job_id}\nStats: ${JSON.stringify(data.stats, null, 2)}`, 'success');
                console.log('Upload success:', data);
            } catch (err) {
                showResult('result1', `Error: ${err.message}`, 'error');
                console.error('Upload exception:', err);
            }
        }

        async function testPaste() {
            const text = document.getElementById('text2').value;
            
            if (!text.trim()) {
                showResult('result2', 'Please paste some text first.', 'error');
                return;
            }

            const fontSize = document.getElementById('fontSize2').value;
            const lineSpacing = document.getElementById('lineSpacing2').value;
            const margin = document.getElementById('margin2').value;
            const toc = document.getElementById('toc2').checked;

            showResult('result2', 'Processing pasted text with formatting options...', 'info');
            console.log('Test Paste:', { textLength: text.length, fontSize, lineSpacing, margin, toc });

            try {
                const blob = new Blob([text], { type: 'text/plain' });
                const file = new File([blob], 'pasted_text.txt', { type: 'text/plain' });

                const formData = new FormData();
                formData.append('file', file);
                formData.append('font_size', fontSize);
                formData.append('line_spacing', lineSpacing);
                formData.append('margin_cm', margin);
                formData.append('include_toc', String(toc));

                console.log('FormData entries:');
                for (let [key, value] of formData.entries()) {
                    console.log(`  ${key}: ${typeof value === 'string' ? value : 'File'}`);
                }

                const response = await fetch(`${API_BASE}/upload`, {
                    method: 'POST',
                    body: formData,
                    credentials: 'include'
                });

                if (!response.ok) {
                    const error = await response.json();
                    showResult('result2', `Error: ${error.error || response.statusText}`, 'error');
                    console.error('Paste error:', error);
                    return;
                }

                const data = await response.json();
                showResult('result2', `âœ“ Success! Job ID: ${data.job_id}\nStats: ${JSON.stringify(data.stats, null, 2)}`, 'success');
                console.log('Paste success:', data);
            } catch (err) {
                showResult('result2', `Error: ${err.message}`, 'error');
                console.error('Paste exception:', err);
            }
        }

        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.style.display = 'block';
            element.className = 'result ' + type;
        }
    </script>
</body>
</html>
